<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    {{- /* Site Information */ -}}

    <title>
        {{- if and (eq .Kind "term") (eq .Section "tags") }}{{ T "tag" }} #{{ end -}}
        {{- if not .IsHome -}} {{ if .Page.Title }}{{ .Page.Title }} â€“ {{ end }} {{- end -}}
        {{- if hugo.IsServer -}} Hugo {{- else -}} {{- .Site.Title -}} {{- end -}}
    </title>

    {{- with .Site.Params.description -}}
        <meta name="description" content="{{ . }}">
    {{- end -}}

    {{- with .Site.Params.author.name -}}
        <meta name="author" content="{{ . }}">
    {{- end -}}

    {{- if .Keywords -}}
        {{- with .Keywords -}}
            <meta name="keywords"
                  content="{{ range $i, $e := . }}{{ if $i }}, {{ end }}{{ $e }}{{ end }}">
        {{- end -}}
    {{- end -}}

    {{- with .Params.robots -}}
        <meta name="robots" content="{{ . }}">
    {{- end -}}

    {{- /* Stylesheet */ -}}
    {{ $main_options := (dict "targetPath" "css/site.css" "outputStyle" "compressed") }}
    {{ $main_template := resources.Get "sass/main.scss" }}
    {{ $main_style := $main_template | resources.ExecuteAsTemplate "main_parsed.scss" . | toCSS $main_options | resources.Minify -}}
    <link rel="stylesheet" href="{{ print $main_style.RelPermalink "?" now.Unix }}">

    {{- /* Canonical URL */ -}}
    <link rel="canonical" href="{{ .Permalink }}">

    {{- /* HTML and RSS alternates */ -}}
    {{- if hugo.IsMultilingual -}}
        {{- /* RSS alternates */ -}}
        {{ with .Site.GetPage "section" "posts" }}
            {{ range .AllTranslations }}
                {{ $lang := .Language.LanguageCode }}
                {{ with .OutputFormats.Get "RSS" }}
                    <link rel="alternate"
                          type="application/rss+xml"
                          hreflang="{{ $lang }}"
                          href="{{ .Permalink | safeURL }}"/>
                {{ end }}
            {{ end }}
            {{- /* x-default */ -}}
            {{ with .OutputFormats.Get "RSS" }}
                <link rel="alternate"
                      type="application/rss+xml"
                      hreflang="x-default"
                      href="{{ .Permalink | safeURL }}"/>
            {{ end }}
        {{ end }}

        {{- /* HTML alternates */ -}}
        {{ $current := . }}
        <link rel="alternate"
              hreflang="{{ .Language.LanguageCode }}"
              href="{{ .Permalink | safeURL }}"/>
        {{ range .Translations }}
            <link rel="alternate"
                  hreflang="{{ .Language.LanguageCode }}"
                  href="{{ .Permalink | safeURL }}"/>
        {{ end }}
        <link rel="alternate"
              hreflang="x-default"
              href="{{ $current.Permalink | safeURL }}"/>
    {{ else }}
        {{- /* Single-language site: just the plain RSS feed, no hreflang */ -}}
        {{ with .Site.GetPage "section" "posts" }}
            {{ with .OutputFormats.Get "RSS" }}
                <link rel="alternate"
                      type="application/rss+xml"
                      href="{{ .Permalink | safeURL }}"/>
            {{ end }}
        {{ end }}
    {{- end -}}

    {{- /* Shortcut Icons */ -}}
    <link rel="icon" href="{{ .Site.Params.icons.favicon }}" sizes="any" type="image/x-icon">
    <link rel="icon" href="{{ .Site.Params.icons.favicon_32 }}" sizes="32x32" type="image/png">
    <link rel="icon" href="{{ .Site.Params.icons.favicon_192 }}" sizes="192x192" type="image/png">
    <link rel="apple-touch-icon" href="{{ .Site.Params.icons.apple_touch }}">

    {{- /* Apple-Specific Meta Tags */ -}}
    <meta name="theme-color" content="#b8b8b8" media="(prefers-color-scheme: light)">
    <meta name="theme-color" content="#000000" media="(prefers-color-scheme: dark)">
    <meta name="format-detection" content="telephone=no">

    {{- /* OG Tags */ -}}
    {{ template "_internal/opengraph.html" . }}

    {{- /*  Mastodon  */ -}}
    <link rel="me" href="https://mastodon.social/@marek_omasta">
    <meta name="fediverse:creator" content="@marek_omasta@mastodon.social">
    
    {{- /*  Schema.org JSON-LD */ -}}
    {{ partial "head-schema-website.html" . }}

    {{- /* Critical JS - Perform before rendering page */ -}}
    <script>
        const html = document.documentElement;
        const storedTheme = localStorage.getItem('theme');

        if (storedTheme) {
            html.classList.add(storedTheme);
        } else if (window.matchMedia('(prefers-color-scheme: light)').matches) {
            html.classList.add('theme-light');
        } else {
            html.classList.add('theme-dark'); // Default theme
        }
    </script>

    {{- /* Critical CSS */ -}}
    <style>
        :root {
            color-scheme: dark light; /* Default theme: dark */
        }

        html.theme-dark {
            background-color: #000;
            color: #fff;
        }

        html.theme-dark svg {
            fill: #b8b8b8;
        }

        html.theme-dark .card {
            background-color: #222;
        }

        html.theme-light .toggle-theme-light,
        html.theme-dark .toggle-theme-dark {
            display: none;
        }

        html {
            font: normal 100% / 1.4 -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen-Sans, Ubuntu, Cantarell, "Helvetica Neue", Arial, sans-serif;
        }

        body:not(.loaded) * {
            transition: none !important;
        }

        #content {
            margin: 0 auto;
            max-width: 670px;
        }

        h1 {
            margin: 0;
        }

        .logo img {
            width: 45px;
            height: 64px;
        }

        .card {
            padding: 24px 20px;
            margin: 8px 0;
        }
    </style>
</head>