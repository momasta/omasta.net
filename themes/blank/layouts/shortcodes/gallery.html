{{/* https://www.codeproject.com/Articles/5276331/Creating-an-Image-Gallery-with-Hugo-and-Lightbox2 */}}

{{/* Optional parameter to specify an asset subdirectory */}}
{{- $param0 := default "" (.Get 0) -}}
{{- $directory := cond (ne "" $param0) (print "/" $param0) "" -}}
{{- $path := (print "images" $directory "/*.{jpg,JPG,jpeg,JPEG,png,PNG,gif,GIF}") -}}

<!--Use eager loading for the first 20 images-->
<div class="gallery">
	{{- $images := (resources.Match $path) -}}

	<div id="gallery-filter">
		<form action="#" id="gallery-filter-form">
			<input type="search"
				   placeholder="Filterâ€¦"
				   id="gallery-filter-input"
				   autocomplete="off"
				   autocapitalize="off"
				   autofocus>
				   
			<input type="submit"
				   value="Filter"
				   tabindex="-1"
				   id="gallery-filter-submit">
		</form>
	</div>
	
	{{ with $images }}
	    {{ range $image_index, $image := . }} 
	    	{{ $imageName := ($image.Name | replaceRE "^.*/(.*)\\..*" "$1") | safeHTMLAttr }} 
	    	
	    	<a href="{{ $image.Permalink }}"
	    	   class="gallery-image state-visible"
	    	   data-lightbox="x"
	    	   data-title="{{ $imageName }}"
	    	   data-alt="{{ $imageName }}">
		    	
		    	<img class="gallery-image-thumb"
			    	 alt="{{ $imageName }}"
		    	
					 {{/* Load first 20 images eagerly (above fold on FullHD) */}}
		    		 loading="{{ cond (gt $image_index 20) "lazy" "eager" }}"
		    		 
		    		 {{/* .Fill not supported for GIFs, use the image itself */}}
		    		 {{- if (eq $image.MediaType.SubType "gif") -}}
			    		src="{{ $image.Permalink }}"
		    		 {{- else -}}
		    			{{- $thumb := $image.Fill "288x288 q75" -}}
			    		src="{{ $thumb.Permalink }}"
		    		 {{- end -}}/>
      		</a>
	    {{ end }}
	{{ end }}
</div>

<link rel="stylesheet" href="/css/lightbox.min.css">

<script src="/js/jquery-3.6.1.min.js"></script>
<script src="/js/lightbox.min.js"></script>
<script src="{{ print "/js/lightbox-options.js?" now.Unix }}"></script>
<script src="{{ print "/js/gallery_filter.js?" now.Unix }}"></script>
